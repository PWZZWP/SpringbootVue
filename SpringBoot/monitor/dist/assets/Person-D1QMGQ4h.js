/* empty css               *//* empty css             *//* empty css              *//* empty css              *//* empty css                  *//* empty css                 */import{r as n}from"./request-Cq_wt7Fs.js";import{a3 as h,a1 as S,r as I,c as i,d as r,w as s,a0 as B,o as p,a as w,h as N,u as R,a4 as k,b as q,g as C,Y as m,p as J,$ as O,_ as A,B as F,S as T,D,A as G}from"./index-B_OMzdnw.js";const M={class:"card",style:{width:"50%",padding:"40px 20px",margin:"auto"}},Y=["src"],$={key:0},j={style:{"text-align":"center"}},z={__name:"Person",emits:["updateUser"],setup(H,{emit:V}){const b=a=>{console.log(a),e.form.avatar=a.data},f=V,c=S(),v=(a,o,u)=>{o===""?u(new Error("请再次确认新密码")):o!==e.form.newPassword?u(new Error("两次输入密码不一致!")):u()},e=I({user:JSON.parse(localStorage.getItem("monitor-user")),form:{},rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],password:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],confirmPassword:[{validator:v,trigger:"blur"}]}});e.user.role==="USER"?n.get("/user/selectById/"+e.user.id).then(a=>{e.form=a.data}):e.form=e.user;const x=()=>{e.user.role==="USER"?n.put("/user/update",e.form).then(a=>{_(),a.code==="200"?(m.success("更新成功！"),localStorage.setItem("monitor-user",JSON.stringify(e.form)),f("updateUser")):m.error(a.msg)}):n.put("/admin/update",e.form).then(a=>{_(),a.code==="200"?(m.success("更新成功！"),localStorage.setItem("monitor-user",JSON.stringify(e.form)),f("updateUser")):m.error(a.msg)})},_=()=>{e.form.id=e.user.id,e.form.role=e.user.role,c.value.validate(a=>{a&&n.put("/updatePassword",e.form).then(o=>{o.code==="200"?(m.success("修改密码成功"),localStorage.removeItem("monitor-user"),setTimeout(()=>{location.href="/login"},1e3)):m.error(o.msg)})})};return(a,o)=>{const u=J,E=O,t=A,d=F,g=T,U=D,y=G,P=B;return p(),i("div",M,[r(P,{ref_key:"formRef",ref:c,rules:e.rules,model:e.form,"label-width":"100px",style:{"padding-right":"50px"}},{default:s(()=>[r(t,{label:"头像"},{default:s(()=>[w("div",null,[r(E,{class:"avatar-uploader",action:"http://localhost:9090/files/upload","show-file-list":!1,"on-success":b},{default:s(()=>[e.form.avatar?(p(),i("img",{key:0,src:e.form.avatar,class:"avatar"},null,8,Y)):(p(),N(u,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[r(R(k))]),_:1}))]),_:1})])]),_:1}),r(t,{label:"账号",prop:"username"},{default:s(()=>[r(d,{disabled:"",modelValue:e.form.username,"onUpdate:modelValue":o[0]||(o[0]=l=>e.form.username=l),autocomplete:"off",placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),r(t,{label:"名称",prop:"name"},{default:s(()=>[r(d,{modelValue:e.form.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e.form.name=l),autocomplete:"off",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e.user.role==="USER"?(p(),i("div",$,[r(t,{label:"性别"},{default:s(()=>[r(U,{modelValue:e.form.sex,"onUpdate:modelValue":o[2]||(o[2]=l=>e.form.sex=l)},{default:s(()=>[r(g,{value:"男",label:"男"}),r(g,{value:"女",label:"女"})]),_:1},8,["modelValue"])]),_:1}),r(t,{label:"描述"},{default:s(()=>[r(d,{rows:3,type:"textarea",modelValue:e.form.description,"onUpdate:modelValue":o[3]||(o[3]=l=>e.form.description=l),autocomplete:"off",placeholder:"请输入个人描述"},null,8,["modelValue"])]),_:1})])):q("",!0),r(t,{label:"原密码",prop:"password"},{default:s(()=>[r(d,{"show-password":"",modelValue:e.form.password,"onUpdate:modelValue":o[4]||(o[4]=l=>e.form.password=l),autocomplete:"off",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),r(t,{label:"新密码",prop:"newPassword"},{default:s(()=>[r(d,{"show-password":"",modelValue:e.form.newPassword,"onUpdate:modelValue":o[5]||(o[5]=l=>e.form.newPassword=l),autocomplete:"off",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),r(t,{label:"确认新密码",prop:"confirmPassword",required:""},{default:s(()=>[r(d,{"show-password":"",modelValue:e.form.confirmPassword,"onUpdate:modelValue":o[6]||(o[6]=l=>e.form.confirmPassword=l),autocomplete:"off",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1}),w("div",j,[r(y,{onClick:x,type:"primary",style:{padding:"20px 30px"}},{default:s(()=>o[7]||(o[7]=[C("更新个人信息")])),_:1})])]),_:1},8,["rules","model"])])}}},re=h(z,[["__scopeId","data-v-09bb14d1"]]);export{re as default};
